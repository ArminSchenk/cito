---
title: "Example: (Multi-) Species distribution models with cito"
author: "Maximilian Pichler"
abstract: "This vignette shows working examples of how to fit (multi-) species distribution models with cito. Training neural networks is tricky compared to other ML algorithms that converge more easily (due to various reasons). The purpose of this vignette is to provide an example workflow and to point out common caveats when training a neural network"
date: "2024-03-04"
output:
 rmarkdown::html_vignette:
    toc: true
    toc_depth: 4
    html_document:
      toc: true
      theme: cerulean
vignette: >
  %\VignetteIndexEntry{Example: (Multi-) Species distribution models with cito}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options:
  chunk_output_type: console
---



## Species distribution model - African elephant

The goal is to build a SDM for the African elephant. A pre-processed dataset from [Angelov, 2020](https://zenodo.org/record/4048271) can be found in the EcoData package which is only available on github:


```r
if(!require(EcoData)) devtools::install_github(repo = "TheoreticalEcology/EcoData",
                         dependencies = FALSE, build_vignettes = FALSE)

library(EcoData)
df = EcoData::elephant$occurenceData
head(df)
#>       Presence       bio1       bio2       bio3       bio4        bio5       bio6       bio7       bio8       bio9       bio10       bio11
#> 3364         0 -0.4981747 -0.2738045  0.5368968 -0.5409999 -0.36843571  0.2947850 -0.5260099 -1.2253960  0.2494100 -0.64527314 -0.06267842
#> 6268         0  0.6085908 -0.5568352  1.0340686 -1.2492050 -0.11835651  0.8221087 -0.8938475  0.4233787  0.7746249  0.09168503  0.94419518
#> 10285        0 -0.7973005  1.4648130 -1.0540532  2.0759423  0.07614953 -1.5860029  1.6284678  0.2768209 -1.5153122 -0.03648161 -1.44165748
#> 2247         0  0.6385034  1.3435141 -0.1591439 -0.5107148  1.10425291 -0.1622288  0.8577603  0.4600181  0.5855475  0.54026827  0.68153250
#> 9821         0  0.6684160 -0.6781341  0.6363311 -0.9906170  0.15950927  0.9099960 -0.8062671  0.3867393  0.8586593  0.31597665  0.94419518
#> 1351         0  0.9675418 -0.6781341 -0.3580126 -0.3748202  0.77081398  0.8748411 -0.3858812  0.3134604  1.0477367  0.98885151  0.94419518
#>            bio12      bio13       bio14        bio15      bio16      bio17       bio18       bio19
#> 3364   0.6285371  0.6807958 -0.29703736 -0.008455252  0.7124535 -0.2949994 -1.06812752  1.96201807
#> 6268   1.1121516  0.5918442  0.01619202 -0.884507980  0.5607328  0.3506918  1.22589281 -0.36205814
#> 10285 -1.2351482 -1.3396742 -0.50585695  0.201797403 -1.3499999 -0.5616980 -0.42763181 -0.62895735
#> 2247   0.5951165  0.8714061 -0.55806185  0.236839512  1.1012378 -0.5616980 -0.20541902 -0.58378979
#> 9821   1.1003561  0.5537222  0.59044589 -1.024676416  0.6413344  0.7437213  0.06254347 -0.05409751
#> 1351   0.7287986  1.1255533 -0.50585695  0.236839512  1.2956300 -0.4494038 -0.90473576  2.47939193
```

Presence is our response variable and we have the 19 bioclim variables as features/predictors.

Let's split part of the data away so that we can use it at the end to evaluate our model:


```r
indices = sample.int(nrow(df), 300)
test = df[indices,]
df = df[-indices,]
```

### Adjusting optimization parameters - Convergence

We will first try a simple DNN with default values and the binomial likelihood. We use 30% of the data as validation holdout to check for overfitting:


```r
library(cito)
model = dnn(Presence~., data = df,
            batchsize = 100L,
            validation = 0.3, loss = "binomial",
            verbose = FALSE)
```

<img src="C/C-unnamed-chunk-4-1.png" style="display: block; margin: auto;" />

We see that the training and test losses were still decreasing which means we didn't train the model long enough. We could now either increase the number of epochs or increase the learning rate so that the model trains faster:


```r
model = dnn(Presence~., data = df,
            batchsize = 100L,
            lr = 0.05,
            validation = 0.3, loss = "binomial",
            verbose = FALSE)
```

<img src="C/C-unnamed-chunk-5-1.png" style="display: block; margin: auto;" />

Much better! But still now enough epochs. Also, let's see if we can further decrease the loss by using a wider and deeper neural network:


```r
model = dnn(Presence~., data = df,
            batchsize = 100L,
            hidden = c(100L, 100L, 100L),
            lr = 0.05,
            validation = 0.3, loss = "binomial",
            verbose = FALSE)
```

<img src="C/C-unnamed-chunk-6-1.png" style="display: block; margin: auto;" />

At the end of the training, the losses start to get jumpy, which can be a sign of potential overfitting. We can control that by adding a weak regularization (but we only want a L2 regularization, so we set alpha to 1.0):


```r
model = dnn(Presence~., data = df,
            batchsize = 100L,
            epochs = 150L,
            hidden = c(100L, 100L, 100L),
            lr = 0.05,
            lambda = 0.001,
            alpha = 1.0,
            validation = 0.3, loss = "binomial",
            verbose = FALSE)
```

<img src="C/C-unnamed-chunk-7-1.png" style="display: block; margin: auto;" />

We will turn on now advanced features that help with the convergence and to reduce overfitting:

-   learning rate scheduler - reduces learning rate during training

-   early stopping - stop training when validation loss starts to increase


```r
model = dnn(Presence~., data = df,
            batchsize = 100L,
            epochs = 150L,
            hidden = c(100L, 100L, 100L),
            lr = 0.05,
            lambda = 0.001,
            alpha = 1.0,
            validation = 0.3, loss = "binomial",
            verbose = FALSE,
            lr_scheduler = config_lr_scheduler("reduce_on_plateau", patience = 7), # reduce learning rate each 7 epochs if the validation loss didn't decrease,
            early_stopping = 14 # stop training when validation loss didn't decrease for 10 epochs
            )
```

<img src="C/C-unnamed-chunk-8-1.png" style="display: block; margin: auto;" />

Great! We found now a model architecture and training procedure that fits and trains well. Let's proceed to our final model

### Train final model with bootstrapping to obtain uncertainties

We haven't directly started with bootstrapping because it complicates the adjustment of the training procedure.

Uncertainties can be obtained by using bootstrapping. Be aware that this can be computational expensive:


```r
model_boot = dnn(Presence~., data = df,
                 batchsize = 100L,
                 epochs = 150L,
                 hidden = c(100L, 100L, 100L),
                 lr = 0.05,
                 lambda = 0.001,
                 alpha = 1.0,
                 validation = 0.3, loss = "binomial",
                 verbose = FALSE,
                 lr_scheduler = config_lr_scheduler("reduce_on_plateau", patience = 7), # reduce learning rate each 7 epochs if the validation loss didn't decrease,
                 early_stopping = 14, # stop training when validation loss didn't decrease for 10 epochs
                 bootstrap = 20L,
                 bootstrap_parallel = 5L
            )
```

### Predictions

We can use the model now for predictions:


```r
predictions = predict(model_boot, newdata = test, reduce = "none")
dim(predictions)
#> [1]  20 300   1
```

The predictions are 2/3 dimensional because of the bootstrapping. Calculate the AUC interval:


```r
hist(sapply(1:20, function(i) Metrics::auc(test$Presence, predictions[i,,])),
     xlim = c(0, 1), main = "AUC of ensemble model", xlab = "AUC")
```

<img src="C/C-unnamed-chunk-11-1.png" style="display: block; margin: auto;" />

We can now predict the habitat suitability of the elephant (Note that spatial dependencies are required):


```r
library(raster)
library(sp)
library(rsample)
library(latticeExtra)
library(sp)
library(ggplot2)
library(maptools)
customPredictFun = function(model, data) {
  return(apply(predict(model, data), 2:3, mean)[,1])
}

normalized_raster = EcoData::elephant$predictionData

predictions =
  raster::predict(normalized_raster,
                  model_boot,
                  fun = customPredictFun)
#> Error in apply(predict(model, data), 2:3, mean): 'MARGIN' does not match dim(X)

habitat_plot =
  spplot(predictions, colorkey = list(space = "left") )
#> Error in (function (classes, fdef, mtable) : unable to find an inherited method for function 'spplot' for signature '"array"'
habitat_plot
#> Error in eval(expr, envir, enclos): object 'habitat_plot' not found
```

Moreover, we can visualize the uncertainty of our model, instead of calculating the average occurrence probability, we calculate for each prediction the standard deviation and visualize it:


```r
customPredictFun_sd = function(model, data) {
  return(apply(predict(model, data), 2:3, sd)[,1])
}
predictions =
  raster::predict(normalized_raster,
                  model_boot,
                  fun = customPredictFun_sd)
#> Error in apply(predict(model, data), 2:3, sd): 'MARGIN' does not match dim(X)

uncertain_plot =
  spplot(predictions, colorkey = list(space = "left") )
#> Error in (function (classes, fdef, mtable) : unable to find an inherited method for function 'spplot' for signature '"array"'
uncertain_plot
#> Error in eval(expr, envir, enclos): object 'uncertain_plot' not found
```

### Inference

Neural networks are often called black-box models but the tools of explainable AI (xAI) allows us to understand them - and actually infer properties similar to what a linear regression model can provide (the calculation can take some time...):


```r
results = summary(model_boot)
results
#> Summary of Deep Neural Network Model
#> 
#> ── Feature Importance
#>          Importance Std.Err Z value Pr(>|z|)   
#> bio1 →        0.400   0.184    2.17   0.0299 * 
#> bio2 →        0.598   0.404    1.48   0.1384   
#> bio3 →        0.859   0.532    1.62   0.1063   
#> bio4 →        0.962   0.591    1.63   0.1034   
#> bio5 →        0.695   0.448    1.55   0.1205   
#> bio6 →        0.460   0.360    1.28   0.2004   
#> bio7 →        0.547   0.296    1.85   0.0641 . 
#> bio8 →        0.520   0.161    3.22   0.0013 **
#> bio9 →        1.293   0.597    2.17   0.0304 * 
#> bio10 →       0.420   0.204    2.06   0.0394 * 
#> bio11 →       0.539   0.310    1.74   0.0816 . 
#> bio12 →       1.084   0.636    1.70   0.0884 . 
#> bio13 →       0.409   0.201    2.03   0.0423 * 
#> bio14 →       0.628   0.316    1.99   0.0468 * 
#> bio15 →       0.893   0.509    1.75   0.0796 . 
#> bio16 →       1.973   1.089    1.81   0.0699 . 
#> bio17 →       0.385   0.230    1.67   0.0941 . 
#> bio18 →       1.023   0.489    2.09   0.0366 * 
#> bio19 →       0.397   0.421    0.94   0.3458   
#> ---
#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#> 
#> ── Average Conditional Effects
#>                ACE   Std.Err Z value Pr(>|z|)    
#> bio1 →    0.023679  0.023263    1.02  0.30872    
#> bio2 →   -0.045357  0.032225   -1.41  0.15928    
#> bio3 →   -0.034480  0.032838   -1.05  0.29372    
#> bio4 →    0.029301  0.027319    1.07  0.28347    
#> bio5 →    0.056930  0.025819    2.20  0.02746 *  
#> bio6 →    0.038777  0.028094    1.38  0.16751    
#> bio7 →   -0.017623  0.035363   -0.50  0.61825    
#> bio8 →    0.006467  0.021137    0.31  0.75965    
#> bio9 →   -0.095411  0.026280   -3.63  0.00028 ***
#> bio10 →   0.007873  0.026620    0.30  0.76741    
#> bio11 →  -0.000125  0.039676    0.00  0.99749    
#> bio12 →  -0.069859  0.026439   -2.64  0.00824 ** 
#> bio13 →   0.038364  0.025865    1.48  0.13801    
#> bio14 →   0.092894  0.036726    2.53  0.01143 *  
#> bio15 →  -0.028159  0.024357   -1.16  0.24764    
#> bio16 →  -0.101030  0.038678   -2.61  0.00900 ** 
#> bio17 →   0.059638  0.023001    2.59  0.00952 ** 
#> bio18 →   0.033631  0.025134    1.34  0.18088    
#> bio19 →  -0.027638  0.042022   -0.66  0.51073    
#> ---
#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#> 
#> ── Standard Deviation of Conditional Effects
#>             ACE Std.Err Z value Pr(>|z|)    
#> bio1 →   0.0949  0.0231    4.10  4.1e-05 ***
#> bio2 →   0.1072  0.0340    3.15  0.00163 ** 
#> bio3 →   0.1112  0.0352    3.16  0.00159 ** 
#> bio4 →   0.1196  0.0289    4.14  3.5e-05 ***
#> bio5 →   0.1211  0.0362    3.35  0.00081 ***
#> bio6 →   0.0884  0.0329    2.69  0.00713 ** 
#> bio7 →   0.0833  0.0215    3.88  0.00010 ***
#> bio8 →   0.1027  0.0209    4.92  8.5e-07 ***
#> bio9 →   0.1441  0.0258    5.58  2.4e-08 ***
#> bio10 →  0.0812  0.0185    4.38  1.2e-05 ***
#> bio11 →  0.1082  0.0224    4.82  1.4e-06 ***
#> bio12 →  0.1282  0.0336    3.82  0.00014 ***
#> bio13 →  0.0912  0.0230    3.97  7.3e-05 ***
#> bio14 →  0.1615  0.0461    3.50  0.00046 ***
#> bio15 →  0.0993  0.0268    3.70  0.00021 ***
#> bio16 →  0.1707  0.0456    3.74  0.00018 ***
#> bio17 →  0.1162  0.0267    4.36  1.3e-05 ***
#> bio18 →  0.1869  0.0435    4.30  1.7e-05 ***
#> bio19 →  0.0834  0.0388    2.15  0.03162 *  
#> ---
#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

Bioclim9, 12, 14, and 16 have large significant average conditional effects (\$\\approx\$ linear effects). We can visualize them using accumulated local effect plots:


```r
par(mfrow = c(1, 4))
ALE(model_boot, variable = "bio9")
```

<img src="C/C-unnamed-chunk-15-1.png" style="display: block; margin: auto;" />

```r
ALE(model_boot, variable = "bio12")
```

<img src="C/C-unnamed-chunk-15-2.png" style="display: block; margin: auto;" />

```r
ALE(model_boot, variable = "bio14")
```

<img src="C/C-unnamed-chunk-15-3.png" style="display: block; margin: auto;" />

```r
ALE(model_boot, variable = "bio16")
```

<img src="C/C-unnamed-chunk-15-4.png" style="display: block; margin: auto;" />

## Multi-species distribution model

Cito supports many different loss functions which we can use to build multi-species distribution models (MSDM). MSDM are multi-label, i.e. they model and predict simoustanously many responses. We will use eucalypts data from [Pollock et al., 2014](https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.12180). The dataset has occurrence of 12 species over 458 sites.


```r
load(url("https://github.com/TheoreticalEcology/s-jSDM/raw/master/sjSDM/data/eucalypts.rda"))
# Environment
head(eucalypts$env)
#>   Rockiness Sandiness VallyBotFlat PPTann Loaminess cvTemp      T0
#> 1        60         1            0    785         0    142 6124.01
#> 2        75         1            0    785         0    142 6124.01
#> 3        70         1            0    780         0    142 3252.96
#> 4        40         1            0    778         0    142 1636.63
#> 5        15         1            0    772         0    142 1352.08
#> 6        80         1            0    841         0    142 5018.48

# PA
head(eucalypts$PA)
#>      ALA ARE BAX CAM GON MEL OBL OVA WIL ALP VIM ARO.SAB
#> [1,]   0   0   0   0   0   0   0   0   1   1   0       0
#> [2,]   0   0   0   0   0   0   1   0   1   1   0       0
#> [3,]   0   0   1   0   0   0   0   0   1   1   0       0
#> [4,]   0   0   1   0   0   0   0   0   1   0   0       0
#> [5,]   0   0   1   0   0   0   1   0   0   0   0       0
#> [6,]   0   0   0   0   0   0   0   0   1   1   0       0
```

Bring data into a format that is usable by cito:


```r
df = cbind(eucalypts$PA, scale(eucalypts$env))
head(df)
#>      ALA ARE BAX CAM GON MEL OBL OVA WIL ALP VIM ARO.SAB  Rockiness Sandiness VallyBotFlat
#> [1,]   0   0   0   0   0   0   0   0   1   1   0       0  1.0315338 0.5716827   -0.5939667
#> [2,]   0   0   0   0   0   0   1   0   1   1   0       0  1.4558834 0.5716827   -0.5939667
#> [3,]   0   0   1   0   0   0   0   0   1   1   0       0  1.3144335 0.5716827   -0.5939667
#> [4,]   0   0   1   0   0   0   0   0   1   0   0       0  0.4657344 0.5716827   -0.5939667
#> [5,]   0   0   1   0   0   0   1   0   0   0   0       0 -0.2415148 0.5716827   -0.5939667
#> [6,]   0   0   0   0   0   0   0   0   1   1   0       0  1.5973333 0.5716827   -0.5939667
#>            PPTann  Loaminess    cvTemp         T0
#> [1,] -0.005981517 -0.2134535 -1.056073  0.5378148
#> [2,] -0.005981517 -0.2134535 -1.056073  0.5378148
#> [3,] -0.045456081 -0.2134535 -1.056073 -0.3404551
#> [4,] -0.061245907 -0.2134535 -1.056073 -0.8348993
#> [5,] -0.108615385 -0.2134535 -1.056073 -0.9219447
#> [6,]  0.436133605 -0.2134535 -1.056073  0.1996271
```

We will use the binomial likelihood - each species occurrence data will be modeled by a binomial likelihood. Build simple model:


```r
model = dnn(cbind(ALA, ARE, BAX, CAM, GON, MEL, OBL, OVA, WIL, ALP, VIM, ARO.SAB)~.,
            data = df,
            verbose = FALSE,
            loss = "binomial")
```

<img src="C/C-unnamed-chunk-18-1.png" style="display: block; margin: auto;" />

Plot model:


```r
plot(model)
```

<img src="C/C-unnamed-chunk-19-1.png" style="display: block; margin: auto;" />

Our NN has now 12 output nodes, one for each species.


```r
head(predict(model))
#>             [,1]       [,2]        [,3]       [,4]        [,5]       [,6]         [,7]       [,8]        [,9]      [,10]
#> [1,] -0.12270716 -0.4097025 -0.13549012 -0.4601613 -0.19417512 -0.4266604 -0.002278566 -0.2800274 -0.18354151 -0.3854755
#> [2,] -0.11254951 -0.4566718 -0.16241667 -0.4842190 -0.22008871 -0.4486834 -0.036245152 -0.2506957 -0.23787370 -0.3810934
#> [3,] -0.09695390 -0.3966816 -0.13949209 -0.4155740 -0.16784129 -0.4336788 -0.046650454 -0.2297206 -0.16061445 -0.3594016
#> [4,] -0.09122226 -0.2955278 -0.11060510 -0.3555744 -0.08685448 -0.3819026  0.009368699 -0.2413719 -0.09328693 -0.3049441
#> [5,] -0.10364718 -0.2526524 -0.09866741 -0.3371338 -0.04829865 -0.3590029  0.042332325 -0.2619660 -0.07392508 -0.2893766
#> [6,] -0.09979991 -0.4753552 -0.16792914 -0.4873370 -0.21548915 -0.4545730 -0.081337906 -0.2399116 -0.21284190 -0.3957028
#>           [,11]       [,12]
#> [1,] -0.3288027 -0.15092361
#> [2,] -0.3267736 -0.18373868
#> [3,] -0.2219123 -0.16022840
#> [4,] -0.1788226 -0.08174880
#> [5,] -0.1774381 -0.05438919
#> [6,] -0.2935849 -0.19181551
```

### Train model with bootstrapping


```r
model_boot = dnn(cbind(ALA, ARE, BAX, CAM, GON, MEL, OBL, OVA, WIL, ALP, VIM, ARO.SAB)~.,
                 data = df,
                 loss = "binomial",
                                  epochs = 200L,
                 hidden = c(50L, 50L),
                 batchsize = 50L,
                 lr = 0.05,
                 lambda = 0.001,
                 alpha = 1.0,
                 validation = 0.2,
                 verbose = FALSE,
                 lr_scheduler = config_lr_scheduler("reduce_on_plateau", patience = 7), # reduce learning rate each 7 epochs if the validation loss didn't decrease,
                 early_stopping = 14, # stop training when validation loss didn't decrease for 10 epochs
                 bootstrap = 20L,
                 bootstrap_parallel = 5L)
```

We haven't really adjusted the training procedure, so let's check the convergence first:


```r
analyze_training(model_boot)
```


### Inference


```r
results = summary(model_boot)
results
#> Summary of Deep Neural Network Model
#> 
#> ── Feature Importance
#>                        Importance   Std.Err Z value Pr(>|z|)  
#> Rockiness → ALA          0.008921  0.033561    0.27    0.790  
#> Sandiness → ALA          0.003210  0.005258    0.61    0.542  
#> VallyBotFlat → ALA       0.016380  0.017682    0.93    0.354  
#> PPTann → ALA             0.010214  0.013305    0.77    0.443  
#> Loaminess → ALA          0.009655  0.005002    1.93    0.054 .
#> cvTemp → ALA             0.014832  0.013382    1.11    0.268  
#> T0 → ALA                -0.004930  0.012548   -0.39    0.694  
#>                                                               
#> Rockiness → ARE          0.005191  0.029653    0.18    0.861  
#> Sandiness → ARE          0.006033  0.008427    0.72    0.474  
#> VallyBotFlat → ARE       0.013256  0.016315    0.81    0.417  
#> PPTann → ARE             0.002865  0.035697    0.08    0.936  
#> Loaminess → ARE          0.009788  0.005996    1.63    0.103  
#> cvTemp → ARE             0.081153  0.321806    0.25    0.801  
#> T0 → ARE                 0.003089  0.008392    0.37    0.713  
#>                                                               
#> Rockiness → BAX          0.008973  0.008330    1.08    0.281  
#> Sandiness → BAX          0.012142  0.012821    0.95    0.344  
#> VallyBotFlat → BAX       0.018275  0.029269    0.62    0.532  
#> PPTann → BAX             0.009655  0.005977    1.62    0.106  
#> Loaminess → BAX          0.005794  0.003555    1.63    0.103  
#> cvTemp → BAX             0.016931  0.033837    0.50    0.617  
#> T0 → BAX                 0.000936  0.003201    0.29    0.770  
#>                                                               
#> Rockiness → CAM          0.010357  0.011075    0.94    0.350  
#> Sandiness → CAM         -0.001932  0.027628   -0.07    0.944  
#> VallyBotFlat → CAM      -0.001057  0.051232   -0.02    0.984  
#> PPTann → CAM             0.009787  0.009229    1.06    0.289  
#> Loaminess → CAM          0.000464  0.007947    0.06    0.953  
#> cvTemp → CAM             0.014365  0.007487    1.92    0.055 .
#> T0 → CAM                -0.001777  0.006100   -0.29    0.771  
#>                                                               
#> Rockiness → GON          0.030075  0.134381    0.22    0.823  
#> Sandiness → GON          0.007311  0.006626    1.10    0.270  
#> VallyBotFlat → GON       0.021561  0.047864    0.45    0.652  
#> PPTann → GON             0.038456  0.123970    0.31    0.756  
#> Loaminess → GON          0.008529  0.005678    1.50    0.133  
#> cvTemp → GON             0.191894  0.817435    0.23    0.814  
#> T0 → GON                 0.009912  0.024459    0.41    0.685  
#>                                                               
#> Rockiness → MEL          0.017726  0.019737    0.90    0.369  
#> Sandiness → MEL          0.009218  0.006159    1.50    0.134  
#> VallyBotFlat → MEL       0.011818  0.012373    0.96    0.340  
#> PPTann → MEL             0.017881  0.011058    1.62    0.106  
#> Loaminess → MEL          0.011723  0.006248    1.88    0.061 .
#> cvTemp → MEL             0.019624  0.008218    2.39    0.017 *
#> T0 → MEL                -0.007622  0.012612   -0.60    0.546  
#>                                                               
#> Rockiness → OBL          0.015656  0.015829    0.99    0.323  
#> Sandiness → OBL          0.001161  0.006516    0.18    0.859  
#> VallyBotFlat → OBL       0.009417  0.008034    1.17    0.241  
#> PPTann → OBL             0.011448  0.006490    1.76    0.078 .
#> Loaminess → OBL         -0.007421  0.007213   -1.03    0.303  
#> cvTemp → OBL             0.014891  0.059079    0.25    0.801  
#> T0 → OBL                 0.004422  0.005943    0.74    0.457  
#>                                                               
#> Rockiness → OVA          0.013253  0.012224    1.08    0.278  
#> Sandiness → OVA          0.002295  0.025428    0.09    0.928  
#> VallyBotFlat → OVA       0.005928  0.036766    0.16    0.872  
#> PPTann → OVA             0.013936  0.010028    1.39    0.165  
#> Loaminess → OVA          0.004073  0.007210    0.56    0.572  
#> cvTemp → OVA             0.013610  0.006598    2.06    0.039 *
#> T0 → OVA                 0.004869  0.005304    0.92    0.359  
#>                                                               
#> Rockiness → WIL          0.008420  0.006857    1.23    0.219  
#> Sandiness → WIL          0.007702  0.006883    1.12    0.263  
#> VallyBotFlat → WIL       0.016109  0.017881    0.90    0.368  
#> PPTann → WIL             0.017570  0.013883    1.27    0.206  
#> Loaminess → WIL         -0.007812  0.006109   -1.28    0.201  
#> cvTemp → WIL             0.021457  0.089559    0.24    0.811  
#> T0 → WIL                 0.002855  0.004076    0.70    0.484  
#>                                                               
#> Rockiness → ALP          0.022280  0.121566    0.18    0.855  
#> Sandiness → ALP          0.006454  0.008170    0.79    0.430  
#> VallyBotFlat → ALP       0.009656  0.016724    0.58    0.564  
#> PPTann → ALP             0.001182  0.097065    0.01    0.990  
#> Loaminess → ALP          0.004963  0.005165    0.96    0.337  
#> cvTemp → ALP             0.003685  0.008167    0.45    0.652  
#> T0 → ALP                 0.005551  0.009055    0.61    0.540  
#>                                                               
#> Rockiness → VIM          0.017209  0.014173    1.21    0.225  
#> Sandiness → VIM          0.004660  0.027062    0.17    0.863  
#> VallyBotFlat → VIM       0.008730  0.040074    0.22    0.828  
#> PPTann → VIM             0.013310  0.008928    1.49    0.136  
#> Loaminess → VIM          0.012296  0.005204    2.36    0.018 *
#> cvTemp → VIM             0.013758  0.007106    1.94    0.053 .
#> T0 → VIM                 0.007685  0.012123    0.63    0.526  
#>                                                               
#> Rockiness → ARO.SAB      0.024319  0.028935    0.84    0.401  
#> Sandiness → ARO.SAB      0.003080  0.004123    0.75    0.455  
#> VallyBotFlat → ARO.SAB   0.011771  0.044168    0.27    0.790  
#> PPTann → ARO.SAB         0.016763  0.012894    1.30    0.194  
#> Loaminess → ARO.SAB      0.001465  0.004620    0.32    0.751  
#> cvTemp → ARO.SAB         0.009377  0.029335    0.32    0.749  
#> T0 → ARO.SAB             0.004116  0.003237    1.27    0.203  
#>                                                               
#> ---
#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#> 
#> ── Average Conditional Effects
#>                              ACE   Std.Err Z value Pr(>|z|)
#> Rockiness → ALA         0.006476  0.014876    0.44     0.66
#> Sandiness → ALA        -0.004312  0.008628   -0.50     0.62
#> VallyBotFlat → ALA      0.001051  0.009509    0.11     0.91
#> PPTann → ALA            0.003327  0.009711    0.34     0.73
#> Loaminess → ALA         0.003465  0.010144    0.34     0.73
#> cvTemp → ALA            0.008227  0.010491    0.78     0.43
#> T0 → ALA                0.000152  0.011909    0.01     0.99
#>                                                            
#> Rockiness → ARE         0.002915  0.012884    0.23     0.82
#> Sandiness → ARE        -0.004737  0.010293   -0.46     0.65
#> VallyBotFlat → ARE      0.002873  0.008344    0.34     0.73
#> PPTann → ARE           -0.000578  0.008711   -0.07     0.95
#> Loaminess → ARE         0.001886  0.009268    0.20     0.84
#> cvTemp → ARE            0.013013  0.017302    0.75     0.45
#> T0 → ARE               -0.002896  0.011553   -0.25     0.80
#>                                                            
#> Rockiness → BAX        -0.003802  0.011934   -0.32     0.75
#> Sandiness → BAX         0.004817  0.013579    0.35     0.72
#> VallyBotFlat → BAX     -0.007142  0.020651   -0.35     0.73
#> PPTann → BAX            0.001018  0.006749    0.15     0.88
#> Loaminess → BAX        -0.002043  0.007151   -0.29     0.78
#> cvTemp → BAX           -0.012786  0.025561   -0.50     0.62
#> T0 → BAX               -0.000716  0.009908   -0.07     0.94
#>                                                            
#> Rockiness → CAM        -0.001644  0.012293   -0.13     0.89
#> Sandiness → CAM        -0.009420  0.010340   -0.91     0.36
#> VallyBotFlat → CAM      0.008775  0.012180    0.72     0.47
#> PPTann → CAM            0.001099  0.007675    0.14     0.89
#> Loaminess → CAM         0.004022  0.011594    0.35     0.73
#> cvTemp → CAM            0.004562  0.011054    0.41     0.68
#> T0 → CAM               -0.004167  0.011543   -0.36     0.72
#>                                                            
#> Rockiness → GON         0.006193  0.011157    0.56     0.58
#> Sandiness → GON        -0.004746  0.010988   -0.43     0.67
#> VallyBotFlat → GON      0.001915  0.012510    0.15     0.88
#> PPTann → GON           -0.003507  0.009416   -0.37     0.71
#> Loaminess → GON         0.005147  0.010263    0.50     0.62
#> cvTemp → GON            0.012806  0.016801    0.76     0.45
#> T0 → GON               -0.003417  0.012373   -0.28     0.78
#>                                                            
#> Rockiness → MEL         0.000278  0.010926    0.03     0.98
#> Sandiness → MEL        -0.005420  0.010849   -0.50     0.62
#> VallyBotFlat → MEL      0.006241  0.012736    0.49     0.62
#> PPTann → MEL            0.000241  0.009010    0.03     0.98
#> Loaminess → MEL         0.004505  0.009819    0.46     0.65
#> cvTemp → MEL            0.005108  0.010602    0.48     0.63
#> T0 → MEL               -0.001332  0.011330   -0.12     0.91
#>                                                            
#> Rockiness → OBL        -0.004373  0.013471   -0.32     0.75
#> Sandiness → OBL        -0.003012  0.010232   -0.29     0.77
#> VallyBotFlat → OBL     -0.000148  0.009736   -0.02     0.99
#> PPTann → OBL           -0.000860  0.010433   -0.08     0.93
#> Loaminess → OBL         0.006572  0.012019    0.55     0.58
#> cvTemp → OBL           -0.006776  0.028598   -0.24     0.81
#> T0 → OBL               -0.000990  0.011375   -0.09     0.93
#>                                                            
#> Rockiness → OVA         0.000519  0.009747    0.05     0.96
#> Sandiness → OVA        -0.008523  0.010109   -0.84     0.40
#> VallyBotFlat → OVA      0.007428  0.011346    0.65     0.51
#> PPTann → OVA            0.001650  0.008646    0.19     0.85
#> Loaminess → OVA         0.005731  0.011681    0.49     0.62
#> cvTemp → OVA            0.005313  0.009080    0.59     0.56
#> T0 → OVA               -0.002973  0.010991   -0.27     0.79
#>                                                            
#> Rockiness → WIL         0.000640  0.012031    0.05     0.96
#> Sandiness → WIL        -0.002564  0.010702   -0.24     0.81
#> VallyBotFlat → WIL      0.000529  0.009737    0.05     0.96
#> PPTann → WIL           -0.000789  0.011430   -0.07     0.94
#> Loaminess → WIL         0.004655  0.009781    0.48     0.63
#> cvTemp → WIL           -0.007429  0.025167   -0.30     0.77
#> T0 → WIL               -0.002845  0.012036   -0.24     0.81
#>                                                            
#> Rockiness → ALP         0.011778  0.013982    0.84     0.40
#> Sandiness → ALP        -0.003647  0.008158   -0.45     0.65
#> VallyBotFlat → ALP      0.001028  0.010947    0.09     0.93
#> PPTann → ALP            0.009424  0.012798    0.74     0.46
#> Loaminess → ALP         0.004554  0.009425    0.48     0.63
#> cvTemp → ALP            0.004112  0.011542    0.36     0.72
#> T0 → ALP               -0.001757  0.012472   -0.14     0.89
#>                                                            
#> Rockiness → VIM        -0.000917  0.011956   -0.08     0.94
#> Sandiness → VIM        -0.009382  0.010658   -0.88     0.38
#> VallyBotFlat → VIM      0.007216  0.012312    0.59     0.56
#> PPTann → VIM            0.002219  0.009261    0.24     0.81
#> Loaminess → VIM         0.004270  0.012030    0.35     0.72
#> cvTemp → VIM            0.003922  0.010137    0.39     0.70
#> T0 → VIM               -0.001704  0.011842   -0.14     0.89
#>                                                            
#> Rockiness → ARO.SAB    -0.007508  0.017230   -0.44     0.66
#> Sandiness → ARO.SAB    -0.007605  0.010103   -0.75     0.45
#> VallyBotFlat → ARO.SAB  0.014789  0.019329    0.77     0.44
#> PPTann → ARO.SAB       -0.001943  0.008595   -0.23     0.82
#> Loaminess → ARO.SAB     0.004489  0.013359    0.34     0.74
#> cvTemp → ARO.SAB       -0.002461  0.017954   -0.14     0.89
#> T0 → ARO.SAB           -0.003793  0.011682   -0.32     0.75
#> 
#> ── Standard Deviation of Conditional Effects
#>                            ACE Std.Err Z value Pr(>|z|)    
#> Rockiness → ALA        0.01941 0.00563    3.45  0.00057 ***
#> Sandiness → ALA        0.01860 0.00329    5.65  1.6e-08 ***
#> VallyBotFlat → ALA     0.01717 0.00342    5.03  5.0e-07 ***
#> PPTann → ALA           0.01704 0.00323    5.27  1.4e-07 ***
#> Loaminess → ALA        0.01126 0.00213    5.30  1.2e-07 ***
#> cvTemp → ALA           0.01769 0.00337    5.26  1.5e-07 ***
#> T0 → ALA               0.01662 0.00474    3.51  0.00045 ***
#>                                                            
#> Rockiness → ARE        0.01921 0.00829    2.32  0.02047 *  
#> Sandiness → ARE        0.01939 0.00464    4.18  3.0e-05 ***
#> VallyBotFlat → ARE     0.01696 0.00433    3.91  9.1e-05 ***
#> PPTann → ARE           0.01727 0.00532    3.25  0.00117 ** 
#> Loaminess → ARE        0.01062 0.00236    4.49  7.1e-06 ***
#> cvTemp → ARE           0.02026 0.01326    1.53  0.12652    
#> T0 → ARE               0.01611 0.00450    3.58  0.00034 ***
#>                                                            
#> Rockiness → BAX        0.01330 0.00549    2.42  0.01538 *  
#> Sandiness → BAX        0.01408 0.00492    2.86  0.00419 ** 
#> VallyBotFlat → BAX     0.01398 0.00895    1.56  0.11837    
#> PPTann → BAX           0.01357 0.00481    2.82  0.00475 ** 
#> Loaminess → BAX        0.00987 0.00307    3.21  0.00132 ** 
#> cvTemp → BAX           0.01398 0.01114    1.26  0.20918    
#> T0 → BAX               0.01351 0.00466    2.90  0.00370 ** 
#>                                                            
#> Rockiness → CAM        0.01660 0.00410    4.05  5.1e-05 ***
#> Sandiness → CAM        0.02005 0.00515    3.89  0.00010 ***
#> VallyBotFlat → CAM     0.01805 0.00463    3.90  9.6e-05 ***
#> PPTann → CAM           0.01631 0.00364    4.48  7.5e-06 ***
#> Loaminess → CAM        0.01148 0.00246    4.67  3.1e-06 ***
#> cvTemp → CAM           0.01723 0.00327    5.27  1.4e-07 ***
#> T0 → CAM               0.01645 0.00396    4.15  3.3e-05 ***
#>                                                            
#> Rockiness → GON        0.02064 0.01019    2.03  0.04276 *  
#> Sandiness → GON        0.01947 0.00362    5.37  7.7e-08 ***
#> VallyBotFlat → GON     0.01734 0.00477    3.64  0.00027 ***
#> PPTann → GON           0.01650 0.00506    3.26  0.00111 ** 
#> Loaminess → GON        0.01144 0.00222    5.14  2.7e-07 ***
#> cvTemp → GON           0.02043 0.01613    1.27  0.20512    
#> T0 → GON               0.01636 0.00452    3.62  0.00030 ***
#>                                                            
#> Rockiness → MEL        0.01818 0.00453    4.02  5.9e-05 ***
#> Sandiness → MEL        0.01993 0.00409    4.87  1.1e-06 ***
#> VallyBotFlat → MEL     0.01928 0.00577    3.34  0.00083 ***
#> PPTann → MEL           0.01642 0.00331    4.96  7.2e-07 ***
#> Loaminess → MEL        0.01116 0.00237    4.71  2.5e-06 ***
#> cvTemp → MEL           0.01769 0.00388    4.56  5.0e-06 ***
#> T0 → MEL               0.01666 0.00492    3.38  0.00071 ***
#>                                                            
#> Rockiness → OBL        0.01605 0.00595    2.70  0.00695 ** 
#> Sandiness → OBL        0.01608 0.00429    3.75  0.00018 ***
#> VallyBotFlat → OBL     0.01513 0.00747    2.03  0.04283 *  
#> PPTann → OBL           0.01365 0.00503    2.71  0.00666 ** 
#> Loaminess → OBL        0.01097 0.00413    2.66  0.00784 ** 
#> cvTemp → OBL           0.01705 0.01389    1.23  0.21978    
#> T0 → OBL               0.01394 0.00438    3.18  0.00147 ** 
#>                                                            
#> Rockiness → OVA        0.01833 0.00432    4.24  2.2e-05 ***
#> Sandiness → OVA        0.01974 0.00418    4.72  2.4e-06 ***
#> VallyBotFlat → OVA     0.01841 0.00417    4.41  1.0e-05 ***
#> PPTann → OVA           0.01652 0.00310    5.33  1.0e-07 ***
#> Loaminess → OVA        0.01180 0.00250    4.71  2.5e-06 ***
#> cvTemp → OVA           0.01725 0.00333    5.18  2.2e-07 ***
#> T0 → OVA               0.01653 0.00479    3.45  0.00056 ***
#>                                                            
#> Rockiness → WIL        0.02016 0.00688    2.93  0.00341 ** 
#> Sandiness → WIL        0.01834 0.00421    4.35  1.3e-05 ***
#> VallyBotFlat → WIL     0.01739 0.00622    2.79  0.00521 ** 
#> PPTann → WIL           0.01707 0.00608    2.81  0.00495 ** 
#> Loaminess → WIL        0.01098 0.00321    3.41  0.00064 ***
#> cvTemp → WIL           0.01939 0.01487    1.30  0.19219    
#> T0 → WIL               0.01682 0.00510    3.30  0.00097 ***
#>                                                            
#> Rockiness → ALP        0.01923 0.00915    2.10  0.03547 *  
#> Sandiness → ALP        0.01768 0.00310    5.70  1.2e-08 ***
#> VallyBotFlat → ALP     0.01646 0.00346    4.76  2.0e-06 ***
#> PPTann → ALP           0.01719 0.00799    2.15  0.03139 *  
#> Loaminess → ALP        0.01099 0.00273    4.03  5.7e-05 ***
#> cvTemp → ALP           0.01791 0.00507    3.54  0.00041 ***
#> T0 → ALP               0.01602 0.00462    3.47  0.00052 ***
#>                                                            
#> Rockiness → VIM        0.01784 0.00516    3.46  0.00054 ***
#> Sandiness → VIM        0.01953 0.00396    4.93  8.3e-07 ***
#> VallyBotFlat → VIM     0.01887 0.00417    4.53  6.0e-06 ***
#> PPTann → VIM           0.01671 0.00368    4.54  5.6e-06 ***
#> Loaminess → VIM        0.01163 0.00305    3.81  0.00014 ***
#> cvTemp → VIM           0.01738 0.00239    7.27  3.7e-13 ***
#> T0 → VIM               0.01745 0.00485    3.60  0.00032 ***
#>                                                            
#> Rockiness → ARO.SAB    0.01816 0.00799    2.27  0.02305 *  
#> Sandiness → ARO.SAB    0.01860 0.00564    3.30  0.00097 ***
#> VallyBotFlat → ARO.SAB 0.01835 0.01277    1.44  0.15053    
#> PPTann → ARO.SAB       0.01582 0.00453    3.49  0.00048 ***
#> Loaminess → ARO.SAB    0.01195 0.00588    2.03  0.04214 *  
#> cvTemp → ARO.SAB       0.01769 0.00855    2.07  0.03865 *  
#> T0 → ARO.SAB           0.01554 0.00439    3.54  0.00040 ***
#> ---
#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

cvTemp is significant for many species. Visualization of the effect:


```r
ale_plots = ALE(model_boot, variable = "cvTemp", plot = FALSE)
do.call(gridExtra::grid.arrange, ale_plots)
```

<img src="C/C-unnamed-chunk-24-1.png" style="display: block; margin: auto;" />
