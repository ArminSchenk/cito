<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="fits a custom deep neural network using the Multilayer Perceptron architecture. dnn() supports the formula syntax and allows to customize the neural network to a maximal degree."><title>DNN — dnn • cito</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="DNN — dnn"><meta property="og:description" content="fits a custom deep neural network using the Multilayer Perceptron architecture. dnn() supports the formula syntax and allows to customize the neural network to a maximal degree."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cito</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A-Introduction_to_cito.html">Introduction to cito</a>
    <a class="dropdown-item" href="../articles/B-Training_neural_networks.html">Training neural networks</a>
    <a class="dropdown-item" href="../articles/C-Example_Species_distribution_modeling.html">Example: (Multi-) Species distribution models with cito</a>
    <a class="dropdown-item" href="../articles/D-Advanced_custom_loss_functions.html">Advanced: Custom loss functions and prediction intervals</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/citoverse/cito/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>DNN</h1>
      <small class="dont-index">Source: <a href="https://github.com/citoverse/cito/blob/HEAD/R/dnn.R" class="external-link"><code>R/dnn.R</code></a></small>
      <div class="d-none name"><code>dnn.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>fits a custom deep neural network using the Multilayer Perceptron architecture. <code>dnn()</code> supports the formula syntax and allows to customize the neural network to a maximal degree.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dnn</span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50L</span>, <span class="fl">50L</span><span class="op">)</span>,</span>
<span>  activation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"relu"</span>, <span class="st">"leaky_relu"</span>, <span class="st">"tanh"</span>, <span class="st">"elu"</span>, <span class="st">"rrelu"</span>, <span class="st">"prelu"</span>, <span class="st">"softplus"</span>,</span>
<span>    <span class="st">"celu"</span>, <span class="st">"selu"</span>, <span class="st">"gelu"</span>, <span class="st">"relu6"</span>, <span class="st">"sigmoid"</span>, <span class="st">"softsign"</span>, <span class="st">"hardtanh"</span>, <span class="st">"tanhshrink"</span>,</span>
<span>    <span class="st">"softshrink"</span>, <span class="st">"hardshrink"</span>, <span class="st">"log_sigmoid"</span><span class="op">)</span>,</span>
<span>  bias <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dropout <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  loss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mse"</span>, <span class="st">"mae"</span>, <span class="st">"softmax"</span>, <span class="st">"cross-entropy"</span>, <span class="st">"gaussian"</span>, <span class="st">"binomial"</span>, <span class="st">"poisson"</span>,</span>
<span>    <span class="st">"mvp"</span><span class="op">)</span>,</span>
<span>  validation <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sgd"</span>, <span class="st">"adam"</span>, <span class="st">"adadelta"</span>, <span class="st">"adagrad"</span>, <span class="st">"rmsprop"</span>, <span class="st">"rprop"</span><span class="op">)</span>,</span>
<span>  lr <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  batchsize <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  burnin <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  baseloss <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  shuffle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bootstrap_parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lr_scheduler <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  custom_parameters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  device <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cpu"</span>, <span class="st">"cuda"</span>, <span class="st">"mps"</span><span class="op">)</span>,</span>
<span>  early_stopping <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tuning <span class="op">=</span> <span class="fu"><a href="config_tuning.html">config_tuning</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Y <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>an object of class "<code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code>": a description of the model that should be fitted</p></dd>


<dt>data</dt>
<dd><p>matrix or data.frame with features/predictors and response variable</p></dd>


<dt>hidden</dt>
<dd><p>hidden units in layers, length of hidden corresponds to number of layers</p></dd>


<dt>activation</dt>
<dd><p>activation functions, can be of length one, or a vector of different activation functions for each layer</p></dd>


<dt>bias</dt>
<dd><p>whether use biases in the layers, can be of length one, or a vector (number of hidden layers + 1 (last layer)) of logicals for each layer.</p></dd>


<dt>dropout</dt>
<dd><p>dropout rate, probability of a node getting left out during training (see <code><a href="https://rdrr.io/pkg/torch/man/nn_dropout.html" class="external-link">nn_dropout</a></code>)</p></dd>


<dt>loss</dt>
<dd><p>loss after which network should be optimized. Can also be distribution from the stats package or own function, see details</p></dd>


<dt>validation</dt>
<dd><p>percentage of data set that should be taken as validation set (chosen randomly)</p></dd>


<dt>lambda</dt>
<dd><p>strength of regularization: lambda penalty, \(\lambda * (L1 + L2)\) (see alpha)</p></dd>


<dt>alpha</dt>
<dd><p>add L1/L2 regularization to training  \((1 - \alpha) * |weights| + \alpha ||weights||^2\) will get added for each layer. Must be between 0 and 1</p></dd>


<dt>optimizer</dt>
<dd><p>which optimizer used for training the network, for more adjustments to optimizer see <code><a href="config_optimizer.html">config_optimizer</a></code></p></dd>


<dt>lr</dt>
<dd><p>learning rate given to optimizer</p></dd>


<dt>batchsize</dt>
<dd><p>number of samples that are used to calculate one learning rate step, default is 10% of the training data</p></dd>


<dt>burnin</dt>
<dd><p>training is aborted if the trainings loss is not below the baseline loss after burnin epochs</p></dd>


<dt>baseloss</dt>
<dd><p>baseloss, if null baseloss corresponds to intercept only models</p></dd>


<dt>shuffle</dt>
<dd><p>if TRUE, data in each batch gets reshuffled every epoch</p></dd>


<dt>epochs</dt>
<dd><p>epochs the training goes on for</p></dd>


<dt>bootstrap</dt>
<dd><p>bootstrap neural network or not, numeric corresponds to number of bootstrap samples</p></dd>


<dt>bootstrap_parallel</dt>
<dd><p>parallelize (CPU) bootstrapping</p></dd>


<dt>plot</dt>
<dd><p>plot training loss</p></dd>


<dt>verbose</dt>
<dd><p>print training and validation loss of epochs</p></dd>


<dt>lr_scheduler</dt>
<dd><p>learning rate scheduler created with <code><a href="config_lr_scheduler.html">config_lr_scheduler</a></code></p></dd>


<dt>custom_parameters</dt>
<dd><p>List of parameters/variables to be optimized. Can be used in a custom loss function. See Vignette for example.</p></dd>


<dt>device</dt>
<dd><p>device on which network should be trained on. mps correspond to M1/M2 GPU devices.</p></dd>


<dt>early_stopping</dt>
<dd><p>if set to integer, training will stop if loss has gotten higher for defined number of epochs in a row, will use validation loss is available.</p></dd>


<dt>tuning</dt>
<dd><p>tuning options created with <code><a href="config_tuning.html">config_tuning</a></code></p></dd>


<dt>X</dt>
<dd><p>Feature matrix or data.frame, alternative data interface</p></dd>


<dt>Y</dt>
<dd><p>Response vector, factor, matrix or data.frame, alternative data interface</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an S3 object of class <code>"cito.dnn"</code> is returned. It is a list containing everything there is to know about the model and its training process.
The list consists of the following attributes:</p>
<dl><dt>net</dt>
<dd><p>An object of class "nn_sequential" "nn_module", originates from the torch package and represents the core object of this workflow.</p></dd>

<dt>call</dt>
<dd><p>The original function call</p></dd>

<dt>loss</dt>
<dd><p>A list which contains relevant information for the target variable and the used loss function</p></dd>

<dt>data</dt>
<dd><p>Contains data used for training the model</p></dd>

<dt>weigths</dt>
<dd><p>List of weights for each training epoch</p></dd>

<dt>use_model_epoch</dt>
<dd><p>Integer, which defines which model from which training epoch should be used for prediction. 1 = best model, 2 = last model</p></dd>

<dt>loaded_model_epoch</dt>
<dd><p>Integer, shows which model from which epoch is loaded currently into model$net.</p></dd>

<dt>model_properties</dt>
<dd><p>A list of properties of the neural network, contains number of input nodes, number of output nodes, size of hidden layers, activation functions, whether bias is included and if dropout layers are included.</p></dd>

<dt>training_properties</dt>
<dd><p>A list of all training parameters that were used the last time the model was trained. It consists of learning rate, information about an learning rate scheduler, information about the optimizer, number of epochs, whether early stopping was used, if plot was active, lambda and alpha for L1/L2 regularization, batchsize, shuffle, was the data set split into validation and training, which formula was used for training and at which epoch did the training stop.</p></dd>

<dt>losses</dt>
<dd><p>A data.frame containing training and validation losses of each epoch</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="loss-functions-likelihoods">Loss functions / Likelihoods<a class="anchor" aria-label="anchor" href="#loss-functions-likelihoods"></a></h2>
    <p>We support loss functions and likelihoods for different tasks:</p><table class="table table"><tr><td>Name</td><td>Explanation</td><td>Example / Task</td></tr><tr><td>mse</td><td>mean squared error</td><td>Regression, predicting continuous values</td></tr><tr><td>mae</td><td>mean absolute error</td><td>Regression, predicting continuous values</td></tr><tr><td>softmax</td><td>categorical cross entropy</td><td>Multi-class, species classification</td></tr><tr><td>cross-entropy</td><td>categorical cross entropy</td><td>Multi-class, species classification</td></tr><tr><td>gaussian</td><td>Normal likelihood</td><td>Regression, residual error is also estimated (similar to <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code>)</td></tr><tr><td>binomial</td><td>Binomial likelihood</td><td>Classification/Logistic regression, mortality</td></tr><tr><td>poisson</td><td>Poisson likelihood</td><td>Regression, count data, e.g. species abundances</td></tr><tr><td>mvp</td><td>multivariate probit model</td><td>joint species distribution model, multi species (presence absence)</td></tr></table></div>
    <div class="section level2">
    <h2 id="training-and-convergence-of-neural-networks">Training and convergence of neural networks<a class="anchor" aria-label="anchor" href="#training-and-convergence-of-neural-networks"></a></h2>
    <p>Ensuring convergence can be tricky when training neural networks. Their training is sensitive to a combination of the learning rate (how much the weights are updated in each optimization step), the batch size (a random subset of the data is used in each optimization step), and the number of epochs (number of optimization steps). Typically, the learning rate should be decreased with the size of the neural networks (depth of the network and width of the hidden layers). We provide a baseline loss (intercept only model) that can give hints about an appropriate learning rate:</p>
<p><img src="figures/learningrates.jpg" alt="Learning rates"></p>
<p>If the training loss of the model doesn't fall below the baseline loss, the learning rate is either too high or too low. If this happens, try higher and lower learning rates.</p>
<p>A common strategy is to try (manually) a few different learning rates to see if the learning rate is on the right scale.</p>
<p>See the troubleshooting vignette (<code><a href="../articles/B-Training_neural_networks.html">vignette("B-Training_neural_networks")</a></code>) for more help on training and debugging neural networks.</p>
    </div>
    <div class="section level2">
    <h2 id="finding-the-right-architecture">Finding the right architecture<a class="anchor" aria-label="anchor" href="#finding-the-right-architecture"></a></h2>
    <p>As with the learning rate, there is no definitive guide to choosing the right architecture for the right task. However, there are some general rules/recommendations: In general, wider, and deeper neural networks can improve generalization - but this is a double-edged sword because it also increases the risk of overfitting. So, if you increase the width and depth of the network, you should also add regularization (e.g., by increasing the lambda parameter, which corresponds to the regularization strength). Furthermore, in <a href="https://arxiv.org/abs/2306.10551" class="external-link">Pichler &amp; Hartig, 2023</a>, we investigated the effects of the hyperparameters on the prediction performance as a function of the data size. For example, we found that the <code>selu</code> activation function outperforms <code>relu</code> for small data sizes (&lt;100 observations).</p>
<p>We recommend starting with moderate sizes (like the defaults), and if the model doesn't generalize/converge, try larger networks along with a regularization that helps minimize the risk of overfitting (see <code><a href="../articles/B-Training_neural_networks.html">vignette("B-Training_neural_networks")</a></code> ).</p>
    </div>
    <div class="section level2">
    <h2 id="overfitting">Overfitting<a class="anchor" aria-label="anchor" href="#overfitting"></a></h2>
    <p>Overfitting means that the model fits the training data well, but generalizes poorly to new observations. We can use the validation argument to detect overfitting. If the validation loss starts to increase again at a certain point, it often means that the models are starting to overfit your training data:</p>
<p><img src="figures/overfitting.jpg" alt="Overfitting"></p>
<p><strong>Solutions</strong>:</p>
<ul><li><p>Re-train with epochs = point where model started to overfit</p></li>
<li><p>Early stopping, stop training when model starts to overfit, can be specified using the <code>early_stopping=…</code> argument</p></li>
<li><p>Use regularization (dropout or elastic-net, see next section)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="regularization">Regularization<a class="anchor" aria-label="anchor" href="#regularization"></a></h2>
    <p>Elastic Net regularization combines the strengths of L1 (Lasso) and L2 (Ridge) regularization. It introduces a penalty term that encourages sparse weight values while maintaining overall weight shrinkage. By controlling the sparsity of the learned model, Elastic Net regularization helps avoid overfitting while allowing for meaningful feature selection. We advise using elastic net (e.g. lambda = 0.001 and alpha = 0.2).</p>
<p>Dropout regularization helps prevent overfitting by randomly disabling a portion of neurons during training. This technique encourages the network to learn more robust and generalized representations, as it prevents individual neurons from relying too heavily on specific input patterns. Dropout has been widely adopted as a simple yet effective regularization method in deep learning.</p>
<p>By utilizing these regularization methods in your neural network training with the cito package, you can improve generalization performance and enhance the network's ability to handle unseen data. These techniques act as valuable tools in mitigating overfitting and promoting more robust and reliable model performance.</p>
    </div>
    <div class="section level2">
    <h2 id="uncertainty">Uncertainty<a class="anchor" aria-label="anchor" href="#uncertainty"></a></h2>
    <p>We can use bootstrapping to generate uncertainties for all outputs. Bootstrapping can be enabled by setting <code>bootstrap = ...</code> to the number of bootstrap samples to be used. Note, however, that the computational cost can be excessive.</p>
<p>In some cases it may be worthwhile to parallelize bootstrapping, for example if you have a GPU and the neural network is small. Parallelization for bootstrapping can be enabled by setting the <code>bootstrap_parallel = ...</code> argument to the desired number of calls to run in parallel.</p>
    </div>
    <div class="section level2">
    <h2 id="custom-optimizer-and-learning-rate-schedulers">Custom Optimizer and Learning Rate Schedulers<a class="anchor" aria-label="anchor" href="#custom-optimizer-and-learning-rate-schedulers"></a></h2>
    <p>When training a network, you have the flexibility to customize the optimizer settings and learning rate scheduler to optimize the learning process. In the cito package, you can initialize these configurations using the <code><a href="config_lr_scheduler.html">config_lr_scheduler</a></code> and <code><a href="config_optimizer.html">config_optimizer</a></code> functions.</p>
<p><code><a href="config_lr_scheduler.html">config_lr_scheduler</a></code> allows you to define a specific learning rate scheduler that controls how the learning rate changes over time during training. This is beneficial in scenarios where you want to adaptively adjust the learning rate to improve convergence or avoid getting stuck in local optima.</p>
<p>Similarly, the <code><a href="config_optimizer.html">config_optimizer</a></code> function enables you to specify the optimizer for your network. Different optimizers, such as stochastic gradient descent (SGD), Adam, or RMSprop, offer various strategies for updating the network's weights and biases during training. Choosing the right optimizer can significantly impact the training process and the final performance of your neural network.</p>
    </div>
    <div class="section level2">
    <h2 id="hyperparameter-tuning">Hyperparameter tuning<a class="anchor" aria-label="anchor" href="#hyperparameter-tuning"></a></h2>
    <p>We have implemented experimental support for hyperparameter tuning. We mark hyperparameters that should be tuned by cito by setting their values to <code><a href="tune.html">tune()</a></code>, for example <code>dnn (..., lr = tune()</code>. <code><a href="tune.html">tune()</a></code> is a function that creates a range of random values for the given hyperparameter. You can also change the maximum and minimum range of these values. The following table lists the hyperparameters that can currently be tuned:</p><table class="table table"><tr><td>Hyperparameter</td><td>Example</td><td>Details</td></tr><tr><td>hidden</td><td><code>dnn(…,hidden=tune(10, 20, fixed=’depth’))</code></td><td>Depth and width can be both tuned or only one of them, if both of them should be tuned, vectors for lower and upper #' boundaries must be provided (first = number of nodes)</td></tr><tr><td>bias</td><td><code>dnn(…, bias=tune())</code></td><td>Should the bias be turned on or off for all hidden layers</td></tr><tr><td>lambda</td><td><code>dnn(…, lambda = tune(0.0001, 0.1))</code></td><td>lambda will be tuned within the range (0.0001, 0.1)</td></tr><tr><td>alpha</td><td><code>dnn(…, lambda = tune(0.2, 0.4))</code></td><td>alpha will be tuned within the range (0.2, 0.4)</td></tr><tr><td>activation</td><td><code>dnn(…, activation = tune())</code></td><td>activation functions of the hidden layers will be tuned</td></tr><tr><td>dropout</td><td><code>dnn(…, dropout = tune())</code></td><td>Dropout rate will be tuned (globally for all layers)</td></tr><tr><td>lr</td><td><code>dnn(…, lr = tune())</code></td><td>Learning rate will be tuned</td></tr><tr><td>batchsize</td><td><code>dnn(…, batchsize = tune())</code></td><td>batch size will be tuned</td></tr><tr><td>epochs</td><td><code>dnn(…, batchsize = tune())</code></td><td>batchsize will be tuned</td></tr></table><p>The hyperparameters are tuned by random search (i.e., random values for the hyperparameters within a specified range) and by cross-validation. The exact tuning regime can be specified with <a href="config_tuning.html">config_tuning</a>.</p>
<p>Note that hyperparameter tuning can be expensive. We have implemented an option to parallelize hyperparameter tuning, including parallelization over one or more GPUs (the hyperparameter evaluation is parallelized, not the CV). This can be especially useful for small models. For example, if you have 4 GPUs, 20 CPU cores, and 20 steps (random samples from the random search), you could run <code>dnn(..., device="cuda",lr = tune(), batchsize=tune(), tuning=config_tuning(parallel=20, NGPU=4)</code>, which will distribute 20 model fits across 4 GPUs, so that each GPU will process 5 models (in parallel).</p>
<p>As this is an experimental feature, we welcome feature requests and bug reports on our github site.</p>
    </div>
    <div class="section level2">
    <h2 id="how-neural-networks-work">How neural networks work<a class="anchor" aria-label="anchor" href="#how-neural-networks-work"></a></h2>
    <p>In Multilayer Perceptron (MLP) networks, each neuron is connected to every neuron in the previous layer and every neuron in the subsequent layer. The value of each neuron is computed using a weighted sum of the outputs from the previous layer, followed by the application of an activation function. Specifically, the value of a neuron is calculated as the weighted sum of the outputs of the neurons in the previous layer, combined with a bias term. This sum is then passed through an activation function, which introduces non-linearity into the network. The calculated value of each neuron becomes the input for the neurons in the next layer, and the process continues until the output layer is reached. The choice of activation function and the specific weight values determine the network's ability to learn and approximate complex relationships between inputs and outputs.</p>
<p>Therefore the value of each neuron can be calculated using: \( a (\sum_j{ w_j * a_j})\). Where \(w_j\) is the weight and \(a_j\) is the value from neuron j to the current one. a() is the activation function, e.g. \( relu(x) = max(0,x)\)</p>
    </div>
    <div class="section level2">
    <h2 id="training-on-graphic-cards">Training on graphic cards<a class="anchor" aria-label="anchor" href="#training-on-graphic-cards"></a></h2>
    <p>If you have an NVIDIA CUDA-enabled device and have installed the CUDA toolkit version 11.3 and cuDNN 8.4, you can take advantage of GPU acceleration for training your neural networks. It is crucial to have these specific versions installed, as other versions may not be compatible.
For detailed installation instructions and more information on utilizing GPUs for training, please refer to the <a href="https://torch.mlverse.org/docs/articles/installation.html" class="external-link">mlverse: 'torch' documentation</a>.</p>
<p>Note: GPU training is optional, and the package can still be used for training on CPU even without CUDA and cuDNN installations.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="predict.citodnn.html">predict.citodnn</a></code>, <code><a href="plot.citodnn.html">plot.citodnn</a></code>,  <code><a href="coef.citodnn.html">coef.citodnn</a></code>,<code><a href="print.citodnn.html">print.citodnn</a></code>, <code><a href="summary.citodnn.html">summary.citodnn</a></code>, <code><a href="continue_training.html">continue_training</a></code>, <code><a href="analyze_training.html">analyze_training</a></code>, <code><a href="PDP.html">PDP</a></code>, <code><a href="ALE.html">ALE</a></code>,</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Christian Amesoeder, Maximilian Pichler</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_is_installed.html" class="external-link">torch_is_installed</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://citoverse.github.io/cito/" class="external-link">cito</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example workflow in cito</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Build and train  Network</span></span></span>
<span class="r-in"><span><span class="co">### softmax is used for multi-class responses (e.g., Species)</span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">&lt;-</span> <span class="fu">dnn</span><span class="op">(</span><span class="va">Species</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span>, loss <span class="op">=</span> <span class="st">"softmax"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The training loss is below the baseline loss but at the end of the</span></span></span>
<span class="r-in"><span><span class="co">## training the loss was still decreasing, so continue training for another 50</span></span></span>
<span class="r-in"><span><span class="co">## epochs</span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="continue_training.html">continue_training</a></span><span class="op">(</span><span class="va">nn.fit</span>, epochs <span class="op">=</span> <span class="fl">50L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sturcture of Neural Network</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot Neural Network</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## 4 Input nodes (first layer) because of 4 features</span></span></span>
<span class="r-in"><span><span class="co">## 3 Output nodes (last layer) because of 3 response species (one node for each</span></span></span>
<span class="r-in"><span><span class="co">## level in the response variable).</span></span></span>
<span class="r-in"><span><span class="co">## The layers between the input and output layer are called hidden layers (two</span></span></span>
<span class="r-in"><span><span class="co">## of them)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We now want to understand how the predictions are made, what are the</span></span></span>
<span class="r-in"><span><span class="co">## important features? The summary function automatically calculates feature</span></span></span>
<span class="r-in"><span><span class="co">## importance (the interpretation is similar to an anova) and calculates</span></span></span>
<span class="r-in"><span><span class="co">## average conditional effects that are similar to linear effects:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To visualize the effect (response-feature effect), we can use the ALE and</span></span></span>
<span class="r-in"><span><span class="co">## PDP functions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Partial dependencies</span></span></span>
<span class="r-in"><span><span class="fu"><a href="PDP.html">PDP</a></span><span class="op">(</span><span class="va">nn.fit</span>, variable <span class="op">=</span> <span class="st">"Petal.Length"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Accumulated local effect plots</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ALE.html">ALE</a></span><span class="op">(</span><span class="va">nn.fit</span>, variable <span class="op">=</span> <span class="st">"Petal.Length"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Per se, it is difficult to get confidence intervals for our xAI metrics (or</span></span></span>
<span class="r-in"><span><span class="co"># for the predictions). But we can use bootstrapping to obtain uncertainties</span></span></span>
<span class="r-in"><span><span class="co"># for all cito outputs:</span></span></span>
<span class="r-in"><span><span class="co">## Re-fit the neural network with bootstrapping</span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">&lt;-</span> <span class="fu">dnn</span><span class="op">(</span><span class="va">Species</span><span class="op">~</span><span class="va">.</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span>,</span></span>
<span class="r-in"><span>             loss <span class="op">=</span> <span class="st">"softmax"</span>,</span></span>
<span class="r-in"><span>             epochs <span class="op">=</span> <span class="fl">150L</span>,</span></span>
<span class="r-in"><span>             verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>             bootstrap <span class="op">=</span> <span class="fl">20L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## convergence can be tested via the analyze_training function</span></span></span>
<span class="r-in"><span><span class="fu"><a href="analyze_training.html">analyze_training</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Summary for xAI metrics (can take some time):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Now with standard errors and p-values</span></span></span>
<span class="r-in"><span><span class="co">## Note: Take the p-values with a grain of salt! We do not know yet if they are</span></span></span>
<span class="r-in"><span><span class="co">## correct (e.g. if you use regularization, they are likely conservative == too</span></span></span>
<span class="r-in"><span><span class="co">## large)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Predictions with bootstrapping:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## predictions are by default averaged (over the bootstrap samples)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Advanced: Custom loss functions and additional parameters</span></span></span>
<span class="r-in"><span><span class="co">## Normal Likelihood with sd parameter:</span></span></span>
<span class="r-in"><span><span class="va">custom_loss</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">true</span>, <span class="va">pred</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">logLik</span> <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/distr_normal.html" class="external-link">distr_normal</a></span><span class="op">(</span><span class="va">pred</span>,</span></span>
<span class="r-in"><span>                               scale <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/nnf_relu.html" class="external-link">nnf_relu</a></span><span class="op">(</span><span class="va">scale</span><span class="op">)</span><span class="op">+</span></span></span>
<span class="r-in"><span>                                 <span class="fl">0.001</span><span class="op">)</span><span class="op">$</span><span class="fu">log_prob</span><span class="op">(</span><span class="va">true</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="va">logLik</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">&lt;-</span> <span class="fu">dnn</span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">~</span><span class="va">.</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span>,</span></span>
<span class="r-in"><span>             loss <span class="op">=</span> <span class="va">custom_loss</span>,</span></span>
<span class="r-in"><span>             verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>             custom_parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">scale</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Multivariate normal likelihood with parametrized covariance matrix</span></span></span>
<span class="r-in"><span><span class="co">## Sigma = L*L^t + D</span></span></span>
<span class="r-in"><span><span class="co">## Helper function to build covariance matrix</span></span></span>
<span class="r-in"><span><span class="va">create_cov</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">LU</span>, <span class="va">Diag</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_matmul.html" class="external-link">torch_matmul</a></span><span class="op">(</span><span class="va">LU</span>, <span class="va">LU</span><span class="op">$</span><span class="fu">t</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_diag.html" class="external-link">torch_diag</a></span><span class="op">(</span><span class="va">Diag</span><span class="op">+</span><span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">custom_loss_MVN</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">true</span>, <span class="va">pred</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">Sigma</span> <span class="op">=</span> <span class="fu">create_cov</span><span class="op">(</span><span class="va">SigmaPar</span>, <span class="va">SigmaDiag</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">logLik</span> <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/distr_multivariate_normal.html" class="external-link">distr_multivariate_normal</a></span><span class="op">(</span><span class="va">pred</span>,</span></span>
<span class="r-in"><span>                                            covariance_matrix <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span><span class="op">$</span></span></span>
<span class="r-in"><span>    <span class="fu">log_prob</span><span class="op">(</span><span class="va">true</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="va">logLik</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">&lt;-</span> <span class="fu">dnn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span>, <span class="va">Petal.Length</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span>,</span></span>
<span class="r-in"><span>             lr <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>             verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>             loss <span class="op">=</span> <span class="va">custom_loss_MVN</span>,</span></span>
<span class="r-in"><span>             custom_parameters <span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SigmaDiag <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    SigmaPar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">6</span>, sd <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">create_cov</span><span class="op">(</span><span class="va">nn.fit</span><span class="op">$</span><span class="va">loss</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">SigmaPar</span>,</span></span>
<span class="r-in"><span>                     <span class="va">nn.fit</span><span class="op">$</span><span class="va">loss</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">SigmaDiag</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 1: 1.147027, lr: 0.01000</span>
<span class="r-plt img"><img src="dnn-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 2: 1.062802, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 3: 1.027987, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 4: 1.000278, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 5: 0.972033, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 6: 0.937462, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 7: 0.905714, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 8: 0.867883, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 9: 0.820265, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 10: 0.783978, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 11: 0.736697, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 12: 0.694761, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 13: 0.651691, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 14: 0.616633, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 15: 0.585468, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 16: 0.561827, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 17: 0.531224, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 18: 0.510264, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 19: 0.501706, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 20: 0.479952, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 21: 0.463698, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 22: 0.449643, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 23: 0.431034, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 24: 0.429456, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 25: 0.413144, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 26: 0.407656, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 27: 0.392666, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 28: 0.381754, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 29: 0.372182, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 30: 0.363579, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 31: 0.348963, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 32: 0.344530, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 33: 0.353960, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 34: 0.334911, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 35: 0.317173, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 36: 0.300646, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 37: 0.293954, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 38: 0.296080, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 39: 0.284076, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 40: 0.291311, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 41: 0.288148, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 42: 0.270681, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 43: 0.264928, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 44: 0.255297, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 45: 0.245981, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 46: 0.253972, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 47: 0.239931, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 48: 0.230850, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 49: 0.224361, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 50: 0.220445, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 51: 0.223183, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 52: 0.208354, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 53: 0.246905, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 54: 0.200085, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 55: 0.198250, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 56: 0.205443, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 57: 0.190526, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 58: 0.191210, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 59: 0.185034, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 60: 0.183529, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 61: 0.176067, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 62: 0.176547, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 63: 0.183867, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 64: 0.175215, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 65: 0.159649, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 66: 0.148164, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 67: 0.164046, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 68: 0.171749, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 69: 0.157298, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 70: 0.156778, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 71: 0.224975, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 72: 0.163844, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 73: 0.145890, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 74: 0.168157, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 75: 0.151109, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 76: 0.136710, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 77: 0.203002, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 78: 0.137719, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 79: 0.146855, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 80: 0.143205, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 81: 0.125238, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 82: 0.142411, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 83: 0.149753, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 84: 0.132040, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 85: 0.159436, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 86: 0.125261, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 87: 0.141266, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 88: 0.120909, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 89: 0.126991, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 90: 0.134337, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 91: 0.116924, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 92: 0.121375, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 93: 0.117202, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 94: 0.126509, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 95: 0.136420, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 96: 0.135311, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 97: 0.115561, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 98: 0.115044, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 99: 0.124308, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 100: 0.133846, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 101: 0.120677, lr: 0.01000</span>
<span class="r-plt img"><img src="dnn-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 102: 0.110739, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 103: 0.120559, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 104: 0.120896, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 105: 0.153420, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 106: 0.116486, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 107: 0.128101, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 108: 0.164217, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 109: 0.115720, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 110: 0.108225, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 111: 0.108674, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 112: 0.098886, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 113: 0.126929, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 114: 0.104872, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 115: 0.117345, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 116: 0.112818, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 117: 0.106633, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 118: 0.114955, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 119: 0.098050, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 120: 0.103447, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 121: 0.109466, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 122: 0.115873, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 123: 0.112238, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 124: 0.109715, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 125: 0.118460, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 126: 0.095143, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 127: 0.115694, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 128: 0.107191, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 129: 0.106784, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 130: 0.121542, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 131: 0.112349, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 132: 0.097964, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 133: 0.105042, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 134: 0.116183, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 135: 0.123278, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 136: 0.136975, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 137: 0.111898, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 138: 0.108386, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 139: 0.108051, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 140: 0.110705, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 141: 0.089660, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 142: 0.102815, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 143: 0.107713, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 144: 0.091297, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 145: 0.118918, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 146: 0.101226, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 147: 0.094658, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 148: 0.130065, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 149: 0.088755, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 150: 0.127953, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dnn(formula = Species ~ Sepal.Length + Sepal.Width + Petal.Length + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Petal.Width - 1, data = datasets::iris, loss = "softmax")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `nn_module` containing 2,953 parameters.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── Modules ─────────────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 0: &lt;nn_linear&gt; #250 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 1: &lt;nn_relu&gt; #0 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 2: &lt;nn_linear&gt; #2,550 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 3: &lt;nn_leaky_relu&gt; #0 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 4: &lt;nn_linear&gt; #153 parameters</span>
<span class="r-plt img"><img src="dnn-3.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of Neighborhoods reduced to 8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of Neighborhoods reduced to 8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of Neighborhoods reduced to 8</span>
<span class="r-plt img"><img src="dnn-4.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="dnn-5.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="dnn-6.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="dnn-7.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1]       [,2]       [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.34375581 0.08177165 0.12150773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.08177165 0.11421397 0.03138565</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.12150773 0.03138565 0.22791524</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Christian Amesöder, Maximilian Pichler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

