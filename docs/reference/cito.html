<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="'cito' simplifies the building and training of (deep) neural networks by relying on standard R syntax and familiar methods from statistical packages. Model creation and training can be done with a single line of code. Furthermore, all generic R methods such as print or plot can be used on the fitted model. At the same time, 'cito' is computationally efficient because it is based on the deep learning framework 'torch' (with optional GPU support). The 'torch' package is native to R, so no Python installation or other API is required for this package."><title>'cito': Building and training neural networks — cito • cito</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="'cito': Building and training neural networks — cito"><meta property="og:description" content="'cito' simplifies the building and training of (deep) neural networks by relying on standard R syntax and familiar methods from statistical packages. Model creation and training can be done with a single line of code. Furthermore, all generic R methods such as print or plot can be used on the fitted model. At the same time, 'cito' is computationally efficient because it is based on the deep learning framework 'torch' (with optional GPU support). The 'torch' package is native to R, so no Python installation or other API is required for this package."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cito</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A-Introduction_to_cito.html">Introduction to cito</a>
    <a class="dropdown-item" href="../articles/B-Training_neural_networks.html">Training neural networks</a>
    <a class="dropdown-item" href="../articles/C-Example_Species_distribution_modeling.html">Example: (Multi-) Species distribution models with cito</a>
    <a class="dropdown-item" href="../articles/D-Advanced_custom_loss_functions.html">Advanced: Custom loss functions and prediction intervals</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/citoverse/cito/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>'cito': Building and training neural networks</h1>
      <small class="dont-index">Source: <a href="https://github.com/citoverse/cito/blob/HEAD/R/cito.R" class="external-link"><code>R/cito.R</code></a></small>
      <div class="d-none name"><code>cito.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>'cito' simplifies the building and training of (deep) neural networks by relying on standard R syntax and familiar methods from statistical packages. Model creation and training can be done with a single line of code. Furthermore, all generic R methods such as print or plot can be used on the fitted model. At the same time, 'cito' is computationally efficient because it is based on the deep learning framework 'torch' (with optional GPU support). The 'torch' package is native to R, so no Python installation or other API is required for this package.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Cito is built around its main function <code><a href="dnn.html">dnn</a></code>, which creates and trains a deep neural network. Various tools for analyzing the trained neural network are available.</p>
    </div>
    <div class="section level2">
    <h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a></h2>
    


<p>in order to install cito please follow these steps:</p>
<p><code>install.packages("cito")</code></p>
<p><code><a href="https://torch.mlverse.org/docs" class="external-link">library(torch)</a></code></p>
<p><code>install_torch(reinstall = TRUE)</code></p>
<p><code><a href="https://citoverse.github.io/cito/" class="external-link">library(cito)</a></code></p>
    </div>
    <div class="section level2">
    <h2 id="cito-functions-and-typical-workflow">cito functions and typical workflow<a class="anchor" aria-label="anchor" href="#cito-functions-and-typical-workflow"></a></h2>
    

<ul><li><p><code><a href="dnn.html">dnn</a></code>: train deep neural network</p></li>
<li><p><code><a href="analyze_training.html">analyze_training</a></code>: check for convergence by comparing training loss with baseline loss</p></li>
<li><p><code><a href="continue_training.html">continue_training</a></code>: continues training of an existing cito dnn model for additional epochs</p></li>
<li><p><code><a href="summary.citodnn.html">summary.citodnn</a></code>: extract xAI metrics/effects to understand how predictions are made</p></li>
<li><p><code><a href="PDP.html">PDP</a></code>: plot the partial dependency plot for a specific feature</p></li>
<li><p><code><a href="ALE.html">ALE</a></code>: plot the accumulated local effect plot for a specific feature</p></li>
</ul><p>Check out the vignettes for more details on training NN and how a typical workflow with 'cito' could look like.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_is_installed.html" class="external-link">torch_is_installed</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://citoverse.github.io/cito/" class="external-link">cito</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example workflow in cito</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Build and train  Network</span></span></span>
<span class="r-in"><span><span class="co">### softmax is used for multi-class responses (e.g., Species)</span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">&lt;-</span> <span class="fu"><a href="dnn.html">dnn</a></span><span class="op">(</span><span class="va">Species</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span>, loss <span class="op">=</span> <span class="st">"softmax"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The training loss is below the baseline loss but at the end of the</span></span></span>
<span class="r-in"><span><span class="co">## training the loss was still decreasing, so continue training for another 50</span></span></span>
<span class="r-in"><span><span class="co">## epochs</span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="continue_training.html">continue_training</a></span><span class="op">(</span><span class="va">nn.fit</span>, epochs <span class="op">=</span> <span class="fl">50L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sturcture of Neural Network</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot Neural Network</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## 4 Input nodes (first layer) because of 4 features</span></span></span>
<span class="r-in"><span><span class="co">## 3 Output nodes (last layer) because of 3 response species (one node for each</span></span></span>
<span class="r-in"><span><span class="co">## level in the response variable).</span></span></span>
<span class="r-in"><span><span class="co">## The layers between the input and output layer are called hidden layers (two</span></span></span>
<span class="r-in"><span><span class="co">## of them)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We now want to understand how the predictions are made, what are the</span></span></span>
<span class="r-in"><span><span class="co">## important features? The summary function automatically calculates feature</span></span></span>
<span class="r-in"><span><span class="co">## importance (the interpretation is similar to an anova) and calculates</span></span></span>
<span class="r-in"><span><span class="co">## average conditional effects that are similar to linear effects:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To visualize the effect (response-feature effect), we can use the ALE and</span></span></span>
<span class="r-in"><span><span class="co">## PDP functions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Partial dependencies</span></span></span>
<span class="r-in"><span><span class="fu"><a href="PDP.html">PDP</a></span><span class="op">(</span><span class="va">nn.fit</span>, variable <span class="op">=</span> <span class="st">"Petal.Length"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Accumulated local effect plots</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ALE.html">ALE</a></span><span class="op">(</span><span class="va">nn.fit</span>, variable <span class="op">=</span> <span class="st">"Petal.Length"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Per se, it is difficult to get confidence intervals for our xAI metrics (or</span></span></span>
<span class="r-in"><span><span class="co"># for the predictions). But we can use bootstrapping to obtain uncertainties</span></span></span>
<span class="r-in"><span><span class="co"># for all cito outputs:</span></span></span>
<span class="r-in"><span><span class="co">## Re-fit the neural network with bootstrapping</span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">&lt;-</span> <span class="fu"><a href="dnn.html">dnn</a></span><span class="op">(</span><span class="va">Species</span><span class="op">~</span><span class="va">.</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span>,</span></span>
<span class="r-in"><span>             loss <span class="op">=</span> <span class="st">"softmax"</span>,</span></span>
<span class="r-in"><span>             epochs <span class="op">=</span> <span class="fl">150L</span>,</span></span>
<span class="r-in"><span>             verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>             bootstrap <span class="op">=</span> <span class="fl">20L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## convergence can be tested via the analyze_training function</span></span></span>
<span class="r-in"><span><span class="fu"><a href="analyze_training.html">analyze_training</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Summary for xAI metrics (can take some time):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Now with standard errors and p-values</span></span></span>
<span class="r-in"><span><span class="co">## Note: Take the p-values with a grain of salt! We do not know yet if they are</span></span></span>
<span class="r-in"><span><span class="co">## correct (e.g. if you use regularization, they are likely conservative == too</span></span></span>
<span class="r-in"><span><span class="co">## large)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Predictions with bootstrapping:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## predictions are by default averaged (over the bootstrap samples)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Hyperparameter tuning (experimental feature)</span></span></span>
<span class="r-in"><span><span class="va">hidden_values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">4</span>, <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">10</span>,<span class="fl">2</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">15</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Potential architectures we want to test, first column == number of nodes</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hidden_values</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span> <span class="op">=</span> <span class="fu"><a href="dnn.html">dnn</a></span><span class="op">(</span><span class="va">Species</span><span class="op">~</span><span class="va">.</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="va">iris</span>,</span></span>
<span class="r-in"><span>             epochs <span class="op">=</span> <span class="fl">30L</span>,</span></span>
<span class="r-in"><span>             loss <span class="op">=</span> <span class="st">"softmax"</span>,</span></span>
<span class="r-in"><span>             hidden <span class="op">=</span> <span class="fu"><a href="tune.html">tune</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">hidden_values</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             lr <span class="op">=</span> <span class="fu"><a href="tune.html">tune</a></span><span class="op">(</span><span class="fl">0.00001</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="co"># tune lr between range 0.00001 and 0.1</span></span></span>
<span class="r-in"><span>             <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Tuning results:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nn.fit</span><span class="op">$</span><span class="va">tuning</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># test = Inf means that tuning was cancelled after only one fit (within the CV)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Advanced: Custom loss functions and additional parameters</span></span></span>
<span class="r-in"><span><span class="co">## Normal Likelihood with sd parameter:</span></span></span>
<span class="r-in"><span><span class="va">custom_loss</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">true</span>, <span class="va">pred</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">logLik</span> <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/distr_normal.html" class="external-link">distr_normal</a></span><span class="op">(</span><span class="va">pred</span>,</span></span>
<span class="r-in"><span>                               scale <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/nnf_relu.html" class="external-link">nnf_relu</a></span><span class="op">(</span><span class="va">scale</span><span class="op">)</span><span class="op">+</span></span></span>
<span class="r-in"><span>                                 <span class="fl">0.001</span><span class="op">)</span><span class="op">$</span><span class="fu">log_prob</span><span class="op">(</span><span class="va">true</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="va">logLik</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">&lt;-</span> <span class="fu"><a href="dnn.html">dnn</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">~</span><span class="va">.</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span>,</span></span>
<span class="r-in"><span>             loss <span class="op">=</span> <span class="va">custom_loss</span>,</span></span>
<span class="r-in"><span>             verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>             custom_parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">scale</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Multivariate normal likelihood with parametrized covariance matrix</span></span></span>
<span class="r-in"><span><span class="co">## Sigma = L*L^t + D</span></span></span>
<span class="r-in"><span><span class="co">## Helper function to build covariance matrix</span></span></span>
<span class="r-in"><span><span class="va">create_cov</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">LU</span>, <span class="va">Diag</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_matmul.html" class="external-link">torch_matmul</a></span><span class="op">(</span><span class="va">LU</span>, <span class="va">LU</span><span class="op">$</span><span class="fu">t</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_diag.html" class="external-link">torch_diag</a></span><span class="op">(</span><span class="va">Diag</span><span class="op">+</span><span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">custom_loss_MVN</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">true</span>, <span class="va">pred</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">Sigma</span> <span class="op">=</span> <span class="fu">create_cov</span><span class="op">(</span><span class="va">SigmaPar</span>, <span class="va">SigmaDiag</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">logLik</span> <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/distr_multivariate_normal.html" class="external-link">distr_multivariate_normal</a></span><span class="op">(</span><span class="va">pred</span>,</span></span>
<span class="r-in"><span>                                            covariance_matrix <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span><span class="op">$</span></span></span>
<span class="r-in"><span>    <span class="fu">log_prob</span><span class="op">(</span><span class="va">true</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="va">logLik</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nn.fit</span><span class="op">&lt;-</span> <span class="fu"><a href="dnn.html">dnn</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span>, <span class="va">Petal.Length</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html" class="external-link">iris</a></span>,</span></span>
<span class="r-in"><span>             lr <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>             verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>             loss <span class="op">=</span> <span class="va">custom_loss_MVN</span>,</span></span>
<span class="r-in"><span>             custom_parameters <span class="op">=</span></span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SigmaDiag <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    SigmaPar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">6</span>, sd <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">create_cov</span><span class="op">(</span><span class="va">nn.fit</span><span class="op">$</span><span class="va">loss</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">SigmaPar</span>,</span></span>
<span class="r-in"><span>                     <span class="va">nn.fit</span><span class="op">$</span><span class="va">loss</span><span class="op">$</span><span class="va">parameter</span><span class="op">$</span><span class="va">SigmaDiag</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 1: 1.088429, lr: 0.01000</span>
<span class="r-plt img"><img src="cito-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 2: 1.035887, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 3: 1.013270, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 4: 0.991179, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 5: 0.968329, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 6: 0.944881, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 7: 0.916637, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 8: 0.888337, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 9: 0.862733, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 10: 0.830708, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 11: 0.803143, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 12: 0.763412, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 13: 0.727293, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 14: 0.696479, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 15: 0.666247, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 16: 0.633855, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 17: 0.608060, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 18: 0.582919, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 19: 0.562153, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 20: 0.540973, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 21: 0.524096, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 22: 0.507354, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 23: 0.489561, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 24: 0.471185, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 25: 0.466094, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 26: 0.446472, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 27: 0.431372, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 28: 0.423958, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 29: 0.414721, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 30: 0.403192, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 31: 0.393885, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 32: 0.385775, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 33: 0.393004, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 34: 0.363961, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 35: 0.354386, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 36: 0.358048, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 37: 0.355654, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 38: 0.343375, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 39: 0.325848, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 40: 0.314229, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 41: 0.308106, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 42: 0.300387, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 43: 0.300284, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 44: 0.292345, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 45: 0.279188, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 46: 0.267606, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 47: 0.259934, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 48: 0.261435, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 49: 0.256924, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 50: 0.246013, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 51: 0.237566, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 52: 0.220349, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 53: 0.225948, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 54: 0.226959, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 55: 0.213669, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 56: 0.215567, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 57: 0.226240, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 58: 0.203317, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 59: 0.193841, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 60: 0.204805, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 61: 0.187479, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 62: 0.184988, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 63: 0.182194, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 64: 0.177360, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 65: 0.180701, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 66: 0.168066, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 67: 0.173457, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 68: 0.170085, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 69: 0.148426, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 70: 0.167103, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 71: 0.158694, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 72: 0.167238, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 73: 0.150845, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 74: 0.141936, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 75: 0.148596, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 76: 0.178108, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 77: 0.145672, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 78: 0.148075, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 79: 0.147604, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 80: 0.144284, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 81: 0.127650, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 82: 0.158944, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 83: 0.135972, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 84: 0.140214, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 85: 0.131873, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 86: 0.128191, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 87: 0.121380, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 88: 0.124197, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 89: 0.121621, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 90: 0.124172, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 91: 0.114655, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 92: 0.119725, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 93: 0.111570, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 94: 0.141998, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 95: 0.116198, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 96: 0.113579, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 97: 0.114693, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 98: 0.117874, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 99: 0.128496, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 100: 0.148026, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 101: 0.104414, lr: 0.01000</span>
<span class="r-plt img"><img src="cito-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 102: 0.104735, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 103: 0.114341, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 104: 0.114584, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 105: 0.120414, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 106: 0.112091, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 107: 0.109068, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 108: 0.097766, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 109: 0.108676, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 110: 0.108171, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 111: 0.119397, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 112: 0.095552, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 113: 0.099149, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 114: 0.109840, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 115: 0.104511, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 116: 0.093153, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 117: 0.116807, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 118: 0.099520, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 119: 0.103608, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 120: 0.090111, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 121: 0.104805, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 122: 0.102121, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 123: 0.091337, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 124: 0.102271, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 125: 0.093534, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 126: 0.083315, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 127: 0.112006, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 128: 0.088168, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 129: 0.087365, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 130: 0.104890, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 131: 0.086678, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 132: 0.087562, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 133: 0.097043, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 134: 0.089176, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 135: 0.109312, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 136: 0.085407, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 137: 0.096208, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 138: 0.102587, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 139: 0.081246, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 140: 0.097927, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 141: 0.087329, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 142: 0.089011, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 143: 0.091464, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 144: 0.139359, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 145: 0.084194, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 146: 0.092621, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 147: 0.084590, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 148: 0.084983, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 149: 0.080080, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Loss at epoch 150: 0.094628, lr: 0.01000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dnn(formula = Species ~ Sepal.Length + Sepal.Width + Petal.Length + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Petal.Width - 1, data = datasets::iris, loss = "softmax")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `nn_module` containing 2,953 parameters.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── Modules ─────────────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 0: &lt;nn_linear&gt; #250 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 1: &lt;nn_relu&gt; #0 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 2: &lt;nn_linear&gt; #2,550 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 3: &lt;nn_leaky_relu&gt; #0 parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> • 4: &lt;nn_linear&gt; #153 parameters</span>
<span class="r-plt img"><img src="cito-3.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of Neighborhoods reduced to 8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of Neighborhoods reduced to 8</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of Neighborhoods reduced to 8</span>
<span class="r-plt img"><img src="cito-4.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="cito-5.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    5    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    4    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]   10    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]   15    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Starting hyperparameter tuning...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting final model...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 10 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    steps  test train models     hidden         lr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     1  60.3     0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.080<span style="text-decoration: underline;">3</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     2  25.8     0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.035<span style="text-decoration: underline;">4</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     3  87.1     0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.088<span style="text-decoration: underline;">0</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     4  41.8     0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.043<span style="text-decoration: underline;">7</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     5 109.      0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.006<span style="text-decoration: underline;">31</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     6  78.2     0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.025<span style="text-decoration: underline;">1</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     7  39.3     0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.060<span style="text-decoration: underline;">7</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     8  55.9     0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.040<span style="text-decoration: underline;">2</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     9  65.0     0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.018<span style="text-decoration: underline;">4</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>    10 <span style="color: #BB0000;">Inf</span>       0 <span style="color: #949494;">&lt;list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [2]&gt;</span> 0.059<span style="text-decoration: underline;">6</span> </span>
<span class="r-plt img"><img src="cito-6.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="cito-7.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]       [,2]        [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  1.37915277  0.0994323 -0.05974418</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.09943230  0.1385776 -0.05360030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -0.05974418 -0.0536003  4.62175798</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Christian Amesöder, Maximilian Pichler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

